#!perl

use strict;
use Getopt::Long;
use Pod::Usage qw(pod2usage);
use Carp qw(croak);

use Conform;
use Conform::Agent;
use Conform::Runtime;
use Conform::Site;
use Conform::Config;
use Conform::Debug;
use Conform::Logger qw($log);
use Conform::Runtime::Server::Posix;
use Conform::SiteLoader;

my @debug;
my @trace;

my $iam;
my $uri;
my $conf_file;
my $runtime;
my @list;


sub usage {
	my %args = @_;
	pod2usage %args;
}

GetOptions(
    'iam=s'         => \$iam,
	'uri=s'         => \$uri,
	'runtime'       => \$runtime,
    'conf-file=s'   => \$conf_file,
    'trace'         => \$Conform::Debug::TRACE,
    'debug'         => \$Conform::Debug::DEBUG,
    'list=s'        => \@list,
	'h|?'           => \&usage
) or usage(msg => 'Invalid parametes');


my $runtime = Conform::Runtime::Server::Posix->new(iam => 'test');
if (@list) {

    $runtime->boot;

    for (@list) {
        /^plugins$/ and do {
            printf "%s Action Providers VERSION = %s, ID = %s\n",
                   $runtime->getName(),
                   $runtime->getVersion() || 0,
                   $runtime->getId();

            for my $provider (@{$runtime->action_providers}) {
                printf "%s %s %s %s %s\n",
                        $provider->getId(),
                        $provider->id(),
                        $provider->name(),
                        $provider->getVersion(),
                        $provider->get_attr('Desc');

            }
        };
    }
    exit 0;
}


my $site    = Conform::SiteLoader->load($uri);
my $agent   = Conform::Agent->new(site => $site, runtime => $runtime);

$agent->conform();


__END__

=head1	NAME

conform

=cut

=head1  SYNOPSIS

    conform [-c /etc/conform.conf]

=cut


# vi: set ts=4 sw=4:
# vi: set expandtab:
